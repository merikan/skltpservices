
<!-- * Copyright 2009 Sjukvardsradgivningen * * This library is free software; 
	you can redistribute it and/or modify * it under the terms of version 2.1 
	of the GNU Lesser General Public * License as published by the Free Software 
	Foundation. * * This library is distributed in the hope that it will be useful, 
	* but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY 
	or FITNESS FOR A PARTICULAR PURPOSE. See the * GNU Lesser General Public 
	License for more details. * * You should have received a copy of the GNU 
	Lesser General Public * License along with this library; if not, write to 
	the * Free Software Foundation, Inc., 59 Temple Place, Suite 330, * Boston, 
	MA 02111-1307 USA -->
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.2"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:spring="http://www.springframework.org/schema/beans"
      xmlns:quartz="http://www.mulesource.org/schema/mule/quartz/2.2"
      xmlns:jaxws="http://cxf.apache.org/jaxws"
      xmlns:context="http://www.springframework.org/schema/context"
      xsi:schemaLocation="http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
               http://www.mulesource.org/schema/mule/core/2.2 http://www.mulesource.org/schema/mule/core/2.2/mule.xsd


               http://www.mulesource.org/schema/mule/quartz/2.2 http://www.mulesource.org/schema/mule/quartz/2.2/mule-quartz.xsd

               http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
               http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

    <spring:bean id="PropertyResolver" class="se.skl.components.pull.PropertyResolver">
        <spring:property name="properties">
            <spring:map>
                <spring:entry key="ei.push.address.servicedomain" value="${ei.push.address.servicedomain}" />
                <spring:entry key="ei.pull.belongsto.hsaid" value="${ei.pull.belongsto.hsaid}" />
                <spring:entry key="ei.address.service.address.logical" value="${ei.address.service.address.logical}" />
                <spring:entry key="ei.address.service.address.logical" value="${ei.address.service.address.logical}" />
                <spring:entry key="ei.push.address.logical" value="${ei.push.address.logical}" />
                <spring:entry key="ei.pull.address.servicedomains" value="${ei.pull.address.servicedomains}" />
                <spring:entry key="ei.pull.time.offset" value="${ei.pull.time.offset}" />
                <spring:entry key="ei.pull.time.format" value="${ei.pull.time.format}" />
            </spring:map>
        </spring:property>
    </spring:bean>

	<spring:beans>
		<spring:import resource="classpath:META-INF/cxf/cxf.xml" />
		<spring:import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
		<spring:import resource="classpath:META-INF/cxf/cxf-extension-http.xml" />

		<jaxws:client id="getAddressesClient"
			serviceClass="se.riv.itintegration.registry.getlogicaladdresseesbyservicecontract.v1.rivtabp21.GetLogicalAddresseesByServiceContractResponderInterface"
			address="${ei.address.service.address.uri}" />

		<jaxws:client id="getUpdatesClient"
			serviceClass="se.riv.itintegration.engagementindex.getupdates.v1.rivtabp21.GetUpdatesResponderInterface"
			address="${ei.pull.address.uri}" />

		<jaxws:client id="updateClient"
			serviceClass="se.riv.itintegration.engagementindex.update.v1.rivtabp21.UpdateResponderInterface"
			address="${ei.push.address.uri}" />

		<context:component-scan base-package="se.skl.components.pull" />

	</spring:beans>

	<model name="EngagementIndex-GetUpdates-trigger-model">

		<service name="EngagementIndex-GetUpdates-trigger-service">

			<inbound>
				<quartz:inbound-endpoint jobName="getUpdatesJob"
					repeatInterval="10000">
					<quartz:event-generator-job />
				</quartz:inbound-endpoint>
			</inbound>


			<component>
				<spring-object bean="engagementIndexPull"></spring-object>
			</component>

		</service>
		
	</model>

</mule>
